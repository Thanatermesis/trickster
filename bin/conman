#!/usr/bin/env ruby

require 'gli'
require 'conman'
require 'erb'

include GLI::App

program_desc 'Bootstrap, generate, and manage your conman presentation'

version Conman::VERSION

desc 'Create a new conman presentation'
arg_name 'dir_name'
command :init do |c|
  c.action do |global_options,options,args|
    puts "init command ran"
  end
end

desc          'File containing your slides'
arg_name      "path"
default_value "slides.md"
flag          [:f,'slides-file']

desc 'Generate the presentation from your slides'
command :build do |c|
  c.desc          'Name of the generated HTML file'
  c.arg_name      'file'
  c.default_value 'index.html'
  c.flag          [:o,'output-file']

  c.action do |global_options,options,args|
    lines  = File.open(global_options[:'slides-file']).readlines.map(&:chomp)
    parser = Conman::SlideParser.new(lines,Conman::SlideRenderer.new)
    body   = parser.body
    title  = parser.title

    erb = ERB.new(File.new(File.expand_path(File.join(File.dirname(__FILE__),'..','erb','index.html.erb'))).readlines.join(""))
    File.open(options[:'output-file'],"w") do |file|
      file.puts erb.result(binding)
    end
  end
end

exit run(ARGV)
